---
// Simple cookie consent banner - no external dependencies
// GDPR-compliant, blocks GA until user consents
---

<!-- Google Analytics (only loads if user consents) -->
<script is:inline>
  const GA_ID = 'G-689LWS7YFE';

  // Check consent on page load
  window.addEventListener('DOMContentLoaded', () => {
    const consent = localStorage.getItem('cookie-consent');

    if (consent === 'accepted') {
      loadGoogleAnalytics();
    } else if (consent === null) {
      // First visit - show banner
      showCookieBanner();
    }
  });

  function showCookieBanner() {
    const banner = document.getElementById('cookie-banner');
    if (banner) banner.style.display = 'block';
  }

  function acceptCookies() {
    localStorage.setItem('cookie-consent', 'accepted');
    document.getElementById('cookie-banner').style.display = 'none';
    loadGoogleAnalytics();
  }

  function declineCookies() {
    localStorage.setItem('cookie-consent', 'declined');
    document.getElementById('cookie-banner').style.display = 'none';
  }

  function loadGoogleAnalytics() {
    if (window.gaLoaded) return;

    // Load gtag.js
    const script = document.createElement('script');
    script.async = true;
    script.src = `https://www.googletagmanager.com/gtag/js?id=${GA_ID}`;
    document.head.appendChild(script);

    // Initialize GA
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    window.gtag = gtag;
    gtag('js', new Date());
    gtag('config', GA_ID, {
      anonymize_ip: true
    });

    window.gaLoaded = true;
  }

  // Expose functions globally for buttons
  window.acceptCookies = acceptCookies;
  window.declineCookies = declineCookies;
</script>

<!-- Cookie Banner -->
<div id="cookie-banner" style="display: none;" class="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-200 shadow-lg p-6 z-50">
  <div class="max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4">
    <div class="flex-1">
      <p class="text-gray-900 font-semibold mb-1">We use cookies</p>
      <p class="text-sm text-gray-600">
        We use Google Analytics to understand how visitors use our site. Your data is anonymous and helps us improve.
        <a href="/cookies" class="text-blue-600 hover:text-blue-700 underline">Learn more</a>
      </p>
    </div>
    <div class="flex gap-3">
      <button
        onclick="window.declineCookies()"
        class="px-4 py-2 bg-gray-200 text-gray-900 rounded-lg hover:bg-gray-300 transition font-semibold"
      >
        Decline
      </button>
      <button
        onclick="window.acceptCookies()"
        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold"
      >
        Accept
      </button>
    </div>
  </div>
</div>

<style>
  #cookie-banner {
    animation: slideUp 0.3s ease-out;
  }

  @keyframes slideUp {
    from {
      transform: translateY(100%);
    }
    to {
      transform: translateY(0);
    }
  }
</style>
